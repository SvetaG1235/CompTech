<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ | CompTech</title>
    <link rel="stylesheet" href="/styles/admin.css">
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="logo">
                <img src="/images/logo.png" alt="CompTech Logo">
                <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="/admin/dashboard">–ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å</a></li>
                    <li><a href="/auth/logout">–í—ã–π—Ç–∏</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="admin-container">
        <div class="orders-admin">
            <div class="filters">
                <select id="statusFilter" class="filter-select">
                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="pending">–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</option>
                    <option value="processing">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                    <option value="shipped">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                    <option value="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
                </select>
                <input type="date" id="dateFromFilter" class="filter-date" placeholder="–°">
                <input type="date" id="dateToFilter" class="filter-date" placeholder="–ü–æ">
                <button id="applyFiltersBtn" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <button id="resetFiltersBtn" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>

            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–¢–æ–≤–∞—Ä—ã</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each orders}}
                    <tr data-status="{{this.status}}">
                        <td>#{{this.id}}</td>
                        <td>
                            {{this.User.name}}<br>
                            {{this.User.phone}}<br>
                            {{this.address}}
                        </td>
                        <td>{{formatDate this.createdAt}}</td>
                        <td>{{this.total}} ‚ÇΩ</td>
                        <td>
                            <select class="status-select" data-id="{{this.id}}">
                                <option value="pending" {{#if (eq this.status 'pending')}}selected{{/if}}>–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</option>
                                <option value="processing" {{#if (eq this.status 'processing')}}selected{{/if}}>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                                <option value="shipped" {{#if (eq this.status 'shipped')}}selected{{/if}}>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                                <option value="delivered" {{#if (eq this.status 'delivered')}}selected{{/if}}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                                <option value="cancelled" {{#if (eq this.status 'cancelled')}}selected{{/if}}>–û—Ç–º–µ–Ω–µ–Ω</option>
                            </select>
                        </td>
                        <td>
                            <button class="btn-view-items" data-id="{{this.id}}">–ü–æ–∫–∞–∑–∞—Ç—å ({{this.Products.length}})</button>
                        </td>
                        <td>
                            <button class="btn-edit" data-id="{{this.id}}">‚úèÔ∏è</button>
                            <a href="/admin/orders/{{this.id}}/invoice" class="btn-invoice">üìÑ</a>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>

            <div id="itemsModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ #<span id="orderId"></span></h3>
                    <div class="modal-body">
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–ö–æ–ª-–≤–æ</th>
                                    <th>–°—É–º–º–∞</th>
                                </tr>
                            </thead>
                            <tbody id="itemsList">
                            </tbody>
                        </table>
                        <div class="order-total">
                            <strong>–ò—Ç–æ–≥–æ: </strong><span id="orderTotal"></span> ‚ÇΩ
                        </div>
                    </div>
                </div>
            </div>

            <div id="editOrderModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #<span id="editOrderId"></span></h3>
                    <div class="modal-body">
                        <form id="editOrderForm">
                            <div class="form-group">
                                <label for="editStatus">–°—Ç–∞—Ç—É—Å:</label>
                                <select id="editStatus" class="form-control">
                                    <option value="pending">–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã</option>
                                    <option value="processing">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                                    <option value="shipped">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</option>
                                    <option value="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editTracking">–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä:</label>
                                <input type="text" id="editTracking" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="editNotes">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                                <textarea id="editNotes" rows="3" class="form-control"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="admin-footer">
        <div class="container">
            <p>&copy; {{currentYear}} CompTech. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å.</p>
        </div>
    </footer>

    <script src="/javascripts/admin/admin-common.js"></script>
    <script src="/javascripts/admin/products.js"></script>
</body>
</html>